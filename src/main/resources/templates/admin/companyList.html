<!doctype html>
<html
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns="http://www.w3.org/1999/html"
        layout:decorate="~{layout/default_layout}" lang="ko">

<div layout:fragment="content">
  <script>
    debugger;
    document.addEventListener("DOMContentLoaded", function () {
      initializePage();
    });
    debugger;
    function initializePage() {
      var companies = document.querySelectorAll('[id^="listPage"]');

      companies.forEach(function (company, index) {
        if (index === 0) {
          var page = document.getElementById("page" + index);
          companies.style.display = 'block';
          page.classList.add("active");
        } else {
          company.style.display = 'none';
        }
      });
    }
    debugger;
    function showOnlySelected(selectedIndex) {
      console.log("click");
      var companies = document.querySelectorAll('[id^="listPage"]');
      companies.forEach(function (company, index) {
        var page = document.getElementById("page" + index);
        if (index === selectedIndex) {
          page.classList.add("active");
          company.style.display = 'block';
        } else {
          page.classList.remove("active");
          company.style.display = 'none';
        }
      });
    }
    debugger;
    function approveCompany(index) {
      // 승인 버튼 클릭 시 호출되는 함수
      // 여기서 index는 Thymeleaf의 반복 변수(companyStat)에서 가져온 것입니다.
      console.log("승인 버튼 클릭: " + index);

      // 여기서 AJAX를 사용하여 서버에 승인 요청을 보낼 수 있습니다.
      // 이 예시에서는 alert으로 확인 창을 띄우고, 실제로는 AJAX 등을 사용하여 서버에 요청을 보내어야 합니다.

      // 승인이 완료되면 해당 행의 approveStatus를 '완료'로 변경하고 화면을 업데이트합니다.
      var approveStatusBadge = document.querySelector('#page' + index + ' [th:text="${company.approveStatus}"]');
      approveStatusBadge.classList.remove('bg-primary');  // 현재 진행중이었다면 클래스 제거
      approveStatusBadge.classList.add('bg-warning');     // '완료'로 변경
      approveStatusBadge.innerText = '완료';
    }

  </script>
  <main>
    <header class="site-header d-flex flex-column justify-content-center align-items-center">
    </header>

    <section class="latest-podcast-section" id="section_2">
      <div class="container">
        <div class="row justify-content-center">
          <!-- 전체 박스 크기 -->
          <div class="col-lg-9 col-12">
            <div class="section-title-wrap mb-5">
              <h4 class="section-title">전체 회원 목록</h4>
            </div>

            <div class="container">
              <div class="row justify-content-end">
                <div class="col-lg-5 col-12 mb-3 d-flex justify-content-end">
                  <div class="btn-group ml-auto">
                    <button type="button" class="btn btn-outline-success"
                            onclick="location.href='/v1/admin/user/list/1/10'">일반 회원
                    </button>
                    <button type="button" class="btn btn-outline-primary"
                            onclick="location.href='/v1/admin/company/list/1/5'">기업 회원
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="row justify-content-center">
              <div class="card bg-outline-light bg-transparent text-dark shadow-lg col-12 post-form">
                <div class="card-body">
                  <!-- 출력 리스트 -->
                  <div class="container mt-5">
<!--                    <div class="col-lg-12 col-12 mb-4 mb-lg-0 text-center" th:if="${#lists.size(listPage) == 0 or listPage == null}">-->
<!--                      <h5>회원이 없습니다.</h5>-->
<!--                    </div>-->
                    <table class="table text-center">
                      <thead>
                      <tr>
                        <th scope="col">INDEX</th>
                        <th scope="col">기업명</th>
                        <th scope="col">업종</th>
                        <th scope="col">이메일</th>
                        <th scope="col">사업자번호</th>
                        <th scope="col">사업자번호 만료 여부</th>
                        <th scope="col">승인 상태</th>
                        <th scope="col">승인 처리</th>
                      </tr>
                      </thead>

                      <!-- 목록 1칸 -->
                      <div class="col-lg-10 col-12 mb-4 mb-lg-2 post-form" th:each="companyList, companyListStat : ${listPage}" th:id="'listPage'+${companyListStat.index}">
                        <tbody>
                          <tr th:each="company, companyStat : ${companyList}">
                              <th scope="row">1</th>
                              <td th:text="${company.name}"></td>
                              <td th:text="${company.email}"></td>
                              <td th:text="${company.employeeNum}"></td>
                              <td th:text="${company.bno}"></td>
                              <td>
                                <div th:if="${company.status == 0}" class="badge bg-warning">만료</div>
                                <div th:if="${company.status == 1}" class="badge bg-success">유효</div>
                              </td>
                              <td th:text="${company.approveStatus}"></td>
                              <td th:text="${company.createdAt}"></td>
                              <td>
                                <div th:if="${company.approveStatus == 1}" class="badge bg-warning">완료</div>
                                <div th:if="${company.approveStatus == 0}" class="badge bg-primary">진행중</div>
                              </td>
                              <td>
                                <!-- 체크박스와 승인 버튼 -->
                                <input type="checkbox" id="approveCheck" name="approveCheck" th:checked="${company.approveStatus == 1}">
                                <button th:if="${company.approveStatus == 0}" onclick="approveCompany([[${companyStat.index}]])">승인</button>
                              </td>
                            </tr>
                          </tbody>
                        </div>

                        <div th:each="company, companyStat : ${companyList}">
                          <tbody>
                          <tr>
                            <th scope="row">1</th>
                            <td th:text="${company.name}"></td>
                            <td th:text="${company.email}"></td>
                            <td th:text="${company.employeeNum}"></td>
                            <td th:text="${company.bno}"></td>
                            <td>
                              <div th:if="${company.status == 0}" class="badge bg-warning">만료</div>
                              <div th:if="${company.status == 1}" class="badge bg-success">유효</div>
                            </td>
                            <td th:text="${company.approveStatus}"></td>
                            <td th:text="${company.createdAt}"></td>
                            <td>
                              <div th:if="${company.approveStatus == '완료'}" class="badge bg-warning">완료</div>
                              <div th:if="${company.approveStatus == '진행중'}" class="badge bg-primary">진행중</div>
                            </td>
                            <td>
                              <!-- 체크박스와 승인 버튼 -->
                              <input type="checkbox" id="approveCheck" name="approveCheck" th:checked="${company.approveStatus == 1}">
                              <button th:if="${company.approveStatus == 0}" onclick="approveCompany([[${companyStat.index}]])">승인</button>
                            </td>
                          </tr>
                          </tbody>
                        </div>

                      </div>
                    </table>
                  </div>

                  <div class="col-lg-4 col-12 mx-auto">
                    <nav aria-label="Page navigation example">
                      <ul class="pagination pagination-lg justify-content-center mt-5">
                        <li class="page-item" th:if="${strNum>=5}">
                          <a class="page-link" th:href="@{/v1/admin/company/list/{strNum}(strNum=${strNum}-5)}"
                             aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                          </a>
                        </li>
                        <div th:each="company, companyStat:${listPage}">
                          <li class="page-item" th:id="'page'+${companyStat.index}">
                            <a class="page-link" th:onclick="showOnlySelected([[${companyStat.index}]])"
                               th:text="${companyStat.index+strNum}"></a>
                          </li>
                        </div>
                        <li class="page-item"
                            th:if="${#lists.size(listPage)>=5 and #lists.size(listPage[4])==5}">
                          <a class="page-link" th:href="@{/v1/admin/company/list/{strNum}(strNum=${strNum}+5)}"
                             aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                          </a>
                        </li>
                      </ul>
                    </nav>
                  </div>

                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </section>
  </main>
</div>

</html>